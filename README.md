# LFRSystem
Приложение для контрольно-пропускного пункта с использованием технологии распознавания лиц.
* Поддерживаются дистрибутивы основанные на пакетной базе Debian 10 и выше.
* NCNN
* С/С++

## <div align="center">Развертывание приложения на Ubuntu = 20.04.4 LTS.</div>
### Установка необходимых зависимостей для Linux

!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! вписать скрипт !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
```
sudo apt-get install build-essential cmake git unzip pkg-config
sudo apt-get install libjpeg-dev libpng-dev libtiff-dev
sudo apt-get install libavcodec-dev libavformat-dev libswscale-dev
sudo apt-get install libgtk2.0-dev libcanberra-gtk*
sudo apt-get install python3-dev python3-numpy python3-pip
sudo apt-get install libxvidcore-dev libx264-dev libgtk-3-dev
sudo apt-get install libtbb2 libtbb-dev libdc1394-22-dev
sudo apt-get install libv4l-dev v4l-utils
sudo apt-get install libgstreamer1.0-dev libgstreamer-plugins-base1.0-dev
sudo apt-get install libavresample-dev libvorbis-dev libxine2-dev
sudo apt-get install libfaac-dev libmp3lame-dev libtheora-dev
sudo apt-get install libopencore-amrnb-dev libopencore-amrwb-dev
sudo apt-get install libopenblas-dev libatlas-base-dev libblas-dev
sudo apt-get install liblapack-dev libeigen3-dev gfortran
sudo apt-get install libhdf5-dev protobuf-compiler
sudo apt-get install libprotobuf-dev libgoogle-glog-dev libgflags-dev

cd opencv-3.3.1/
mkdir build
cd build
cmake -D CMAKE_BUILD_TYPE=RELEASE \
-D CMAKE_INSTALL_PREFIX=/usr \
-D OPENCV_EXTRA_MODULES_PATH=~/opencv_contrib/modules \
-D EIGEN_INCLUDE_PATH=/usr/include/eigen3 \
-D WITH_OPENCL=OFF \
-D WITH_CUDA=ON \
-D CUDA_ARCH_BIN=5.3 \
-D CUDA_ARCH_PTX="" \
-D WITH_CUDNN=ON \
-D WITH_CUBLAS=ON \
-D ENABLE_FAST_MATH=ON \
-D CUDA_FAST_MATH=ON \
-D OPENCV_DNN_CUDA=ON \
-D ENABLE_NEON=ON \
-D WITH_QT=OFF \
-D WITH_OPENMP=ON \
-D BUILD_TIFF=ON \
-D WITH_FFMPEG=ON \
-D WITH_GSTREAMER=ON \
-D WITH_TBB=ON \
-D BUILD_TBB=ON \
-D BUILD_TESTS=OFF \
-D WITH_EIGEN=ON \
-D WITH_V4L=ON \
-D WITH_LIBV4L=ON \
-D OPENCV_ENABLE_NONFREE=ON \
-D INSTALL_C_EXAMPLES=OFF \
-D INSTALL_PYTHON_EXAMPLES=OFF \
-D PYTHON3_PACKAGES_PATH=/usr/lib/python3/dist-packages \
-D OPENCV_GENERATE_PKGCONFIG=ON \
-D BUILD_EXAMPLES=OFF ..

make -j4

sudo make install
sudo ldconfig
make clean

sudo apt install qt5-default


```

## <div align="center">Сборка</div>
### Клонировать репозиторий
```
git clone https://github.com/ArtemAmelchenko/LFRSystem.git
```
**ПОЛНАЯ СБОРКА ОДНОЙ КОМАНДОЙ**: Перейти в директорию
```
cd build/
make
```



# Удаление компонентов
```
cd build/
make clean 
```





____
# Пользователи

!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! добавить в следующей версии !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

____
# Роли

____
# Конфигурации

____
# Описание
Приложение для управления пропускным пунктом. Позволяет настраивать пропускной пункт (добавлять/редактировать/удалять камеры и реле, и связывать их) и изменять базу персональных карт (добавлять/редактировать/удалять персональные карты людей). После настройки приложение позволяет отслеживать происходящие события, а также отправляет их на сервер при установленном подключении.
## Настройка
Для настройки камер нужно выбрать Меню->Камеры->Управление камерами. Пользователю будет показано окно управления камерами. В левой части этого окна находится область добавления камеры. В ней можно выбрать протокол, саму камеру (в случае usb) или ввести текст запроса (в случае rtsp), а также указать вход/выход (в какую сторону направлена камера) и привязать реле. В правой части окна находится область с уже добавленными видеопотоками, где можно посмотреть информацию о них, увидеть сами видеопотоки и удалить их при необходимости.
Для настройки реле нужно выбрать Меню->Устройства->Управление устройствами. В данном окне можно .................
## Редактирование персональных карт
Для редактирования персональных карт нужно выбрать Меню->Файл->Редактирование персональных карт. Открывшееся окно разделено на две части. В левой части находится список персональных карт. В правой - три раздела (просмотр/редактирование/добавление). Для осуществления нужного действия необходимо выбрать соответствующий раздел и взаимодействовать с появившимися полями ввода. Для выбора фото предусмотрена специальная кнопка. После заполнения полей необходимо нажать соответствующую кнопку (редактировать/добавить). Для закрытия окна с сохранением изменений нужно нажать "ОК", после чего согласиться с внесением изменений.
## Отслеживание происходящих событий.
Событием считается распознавание в кадре лица, внесённого в базу. Возможны следующие случаи:
Нарушено зонирование (человек не входил, но пытается выйти)
Спуфинг (распознана попытка обмана путём показа фото вместо реального лица)
ОК (всё в порядке, в таком случае откроется соответствующий турникет и человек будет считаться пропущенным)
В левой нижней части главного окна отображаются последние пять событий и соответствующие им карточки. К какому из перечисленных случаев относится событие, можно понять по соответствующей надписи (ЗОН, СПУФ, ОК). Правая нижняя часть главного окна отображает количество человек в здании, а также сходство и достоверность последнего распознавания лица.
## Влияние освещения на качество распознавания
Для корректной работы программы требуется качественное освещение тех областей, где предполагается нахождение лиц людей при их взгляде в камеру (проще говоря, лица должны быть нормально освещены). В случае черезмерного освещения программа с большой вероятностью будет показывать меньший уровень сходства и его может не хватить для того, чтобы программа посчитала человека идентифицированным. Также, в этом случае возможно падение уровня достоверности (из за появления бликов и неестественного света).
В случае недостаточного освещения система работает лучше, чем при избыточном. Распознавание и идентификация прекращаются, когда в кадре становится совсем темно.
Исходя из вышесказанного, при настройке освещения стоит ориентироваться на средний уровень света с уклоном в тёмную сторону и избегать появления бликов, ощутимых различий в освещении разных частей лица.

